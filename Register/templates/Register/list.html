{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="utf-8">
    <title>لیست کاربران</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">

    <script>
        function redirectToPage(url) {
            window.location.href = url;
        }

        $(document).ready(function () {
            $("#birth_date").persianDatepicker({
                format: "YYYY/MM/DD",
                altField: ".dateAlt",
                altFormat: "YYYY/MM/DD",
                observer: true,
                calendarType: "persian",
                toolbox: {
                    calendarSwitch: {
                        enabled: false
                    }
                }
            });

            $("#registration-form").submit(function (event) {
                event.preventDefault();
                $.ajax({
                    type: "POST",
                    url: "{% url 'register_class_name' %}",
                    data: $(this).serialize(),
                    success: function () {
                        var name = $("#first_name").val();
                        var lastName = $("#last_name").val();
                        alert("نام: " + name + "\nنام خانوادگی: " + lastName);
                        $("#registration-form")[0].reset();
                        location.reload();
                    }
                });
            });
        });
    </script>
</head>

<body id="bala">
<header>
    <div class="div-blue">
        <img class="khomeini" src="{% static 'img/emam2.png' %}">
        <img class="agha" src="{% static 'img/agha1.png' %}">
        <img class="logo_h" src="{% static 'img/logo_h.png' %}" onclick="redirectToPage('{% url 'list' %}')">
        <img class="masjed_logo" src="{% static 'img/masjed_logo.png' %}"
             onclick="redirectToPage('{% url 'register_class_name' %}')">
    </div>
</header>
<br>
<br>
<div class="serceh_list">
    <form method="get" action="{% url 'list' %}">
        {% csrf_token %}
        <label for="name_search">نام: </label>
        <input autocomplete="off" id="name_search" name="name_search" value="{{ request.GET.name_search }}">
        <label for="last_name_search">نام خانوادگی: </label>
        <input autocomplete="off" id="last_name_search" name="last_name_search"
               value="{{ request.GET.last_name_search }}">
        <br>
        <label for="classes">انتخاب کلاس : </label>
        <select id="classes" class="form-control" name="classes">
            <option value="">لیست کامل</option>
            {% for class in classes %}
                <option value="{{ class.id }}"
                        {% if class.id|stringformat:"s" in request.GET.classes %}selected{% endif %}>{{ class.class_name }}</option>
            {% endfor %}
        </select>
        <div class="btn-sub-search">
            <button style="transition: all 1s; margin-top: 10px;" type="submit">جستجو</button>
        </div>
    </form>
</div>

<div class="table-container-wrapper">
    <table class="table-container">
        <thead class="hd_fix">
        <tr>
            <th>نام</th>
            <th>نام خانوادگی</th>
            <th>کد ملی</th>
            <th>سن</th>
            <th>شماره تلفن</th>
            <th>مبلغ پرداخت شده : {{ Money }}</th>
            <th>جمع هزینه کلاس ها: {{ price }} </th>
            <th>مبلغ قابل پرداخت : {{ price_2 }} </th>
            <th>میانگین سنی : {{ Average }} تعداد : {{ students_data|length }}</th>
        </tr>
        </thead>
        <tbody>
        {% for data in students_data %}
            <tr>
                <td>{{ data.student.first_name }}</td>
                <td>{{ data.student.last_name }}</td>
                <td>{{ data.student.national_code }}</td>
                <td>{{ data.student.age }}</td>
                <td>{{ data.student.contact_number }}</td>
                <td>{{ data.student.payment_amount }}</td>
                <td>{{ data.total_class_cost }}</td>
                <td>{{ data.remaining_amount }}</td>
                <td>
                    <a href="{% url 'update_name' data.student.id %}" class="btn-test">ویرایش</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <a class="a_up" href="#bala">
        <div class="btn_top"><img src="{% static 'img/up.png' %}" alt="بالا"></div>
    </a>
</div>
</body>
</html>
